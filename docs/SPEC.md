# Smart Tabs 기능 명세서

## 1. 개요

**Smart Tabs**는 VS Code 스타일의 탭 동작을 Obsidian에 구현한 플러그인입니다. 파일을 탐색할 때는 탭이 쌓이지 않고, 명시적으로 열거나 편집할 때만 새 탭이 생성됩니다.

### 탭 상태

| 상태 | 설명 | 시각적 표시 |
|------|------|-------------|
| **Empty** | 빈 탭 (아무것도 열리지 않음) | - |
| **Preview** | 임시 탭, 다른 파일을 열면 재사용됨 | 탭 제목 *이탤릭* |
| **Permanent** | 고정 탭, 명시적으로 닫기 전까지 유지 | 탭 제목 일반 |

---

## 2. 공통(전역) 규칙

모든 동작에 공통으로 적용되는 규칙입니다.

### 패널당 Preview 1개

같은 패널(탭 그룹) 내에서는 Preview 탭이 최대 1개만 존재합니다.

**Preview로 파일을 열어야 할 때:**
1. 같은 패널에 기존 Preview 탭이 있으면 → 그 탭을 재사용
2. 없으면:
   - 현재 탭이 Empty → 해당 탭에 Preview로 열기
   - 현재 탭이 Permanent → 새 Preview 탭 생성

### 중복 열기 방지

같은 패널 내에서 이미 열려있는 파일이나 뷰를 다시 클릭하면 새 탭을 만들지 않고 기존 탭으로 포커스 이동:
- **파일**: 같은 경로의 파일이 열려있으면 포커스 이동
- **비파일 뷰**: 같은 뷰 타입(그래프, Canvas 등)이 열려있으면 포커스 이동

### Modifier Key 동작

Obsidian의 기본 동작을 따릅니다:
- **Ctrl/Cmd + Click**: 새 탭에서 열기

### 포커스 관리

- 새 탭이 생성되면 자동으로 해당 탭으로 포커스 이동
- 탭을 닫으면 파일 탐색기의 활성 상태(`activeDom`, `has-focus` 클래스 등) 자동 정리

---

## 3. 패턴별 규칙

### Browse 패턴 (표준 탐색)

파일을 둘러보는 동작입니다. **Preview 모드**로 열립니다.

| 현재 탭 상태 | 동작 |
|-------------|------|
| **Empty** | 해당 탭에 **Preview**로 열기 |
| **Permanent** | 기존 Preview 탭 재사용, 없으면 새 Preview 탭 생성 |
| **Preview** | 해당 탭에서 **Preview**로 교체 |

### Open 패턴 (명시적 열기)

명시적으로 파일을 열겠다는 의도입니다. **더블클릭**으로 트리거됩니다.

| 현재 탭 상태 | 동작 |
|-------------|------|
| **Empty** | 해당 탭에 **Permanent**로 열기 |
| **Permanent** | 보존 → 새 **Permanent** 탭 생성 |
| **Preview** (다른 파일) | 해당 탭에서 **Permanent**로 교체 |
| **Preview** (같은 파일) | **Permanent**로 승격 |

### Create 패턴 (파일 생성)

새 파일을 생성하는 동작입니다. 항상 **Permanent 탭**으로 열립니다.

| 현재 탭 상태 | 동작 |
|-------------|------|
| **Empty** | 해당 탭에 **Permanent**로 생성 |
| **Permanent** | 보존 → 새 **Permanent** 탭 생성 |
| **Preview** | 보존 → 새 **Permanent** 탭 생성 |

### Promote 패턴 (자동 승격)

다음 트리거 발생 시 Preview 탭이 자동으로 Permanent로 승격됩니다.

| 트리거 | 설명 |
|--------|------|
| **본문 편집** | 에디터에서 첫 글자 입력 시 |
| **인라인 제목 편집** | 노트 상단 제목 수정 시 (300ms debounce) |
| **파일 이름 변경** | vault의 rename 이벤트 발생 시 |
| **Canvas 편집** | 노드 추가/수정/삭제, 연결선 변경 시 |
| **더블 클릭** | 탭 헤더 또는 사이드바에서 더블 클릭 |

---

## 4. 패턴 예외 규칙

특정 상황에서 기본 패턴과 다르게 동작하는 경우입니다.

### Preview 탭 보존

**새 노트 생성 시** 현재 Preview 탭은 승격되지 않고 그대로 유지됩니다.

| 현재 탭 상태 | 일반 Browse | 새 노트 생성 |
|-------------|------------|-------------|
| **Preview** | Preview로 교체 | **보존** → 새 Permanent 생성 |

### Daily Notes 특별 처리

Daily Notes는 생성/열기 모두 **Create 패턴**으로 처리됩니다.

- 판별 기준: Daily Notes 플러그인 설정(날짜 포맷, 저장 경로)을 참조하여 자동 판별

### 빈 탭보다 Preview 우선

빈 탭(Empty)이 있어도 기존 Preview 탭을 우선 재사용합니다.

| 패널 상태 | Browse 시 동작 |
|---------|---------------|
| Preview + Empty | Preview 재사용 (Empty 사용 안 함) |
| Permanent + Empty | Empty에 Preview로 열기 |

---

## 5. 기능별 상세

각 UI 요소별 구체적인 동작입니다.

### 파일 탐색기 (File Explorer)

| 동작 | 패턴 |
|------|------|
| 싱글 클릭 | Browse 패턴 |
| 더블 클릭 | Open 패턴 |

### Quick Switcher (Ctrl+O)

| 동작 | 패턴 |
|------|------|
| 파일 선택 | Browse 패턴 |

### 북마크 (Bookmarks)

| 동작 | 패턴 |
|------|------|
| 싱글 클릭 | Browse 패턴 |
| 더블 클릭 | Open 패턴 |

### 검색 (File Search)

| 동작 | 패턴 |
|------|------|
| 싱글 클릭 | Browse 패턴 |
| 더블 클릭 | Open 패턴 |

### 그래프 뷰 (Graph View)

| 동작 | 패턴 |
|------|------|
| 그래프 뷰 실행 | Browse 패턴 |
| 노드 싱글 클릭 | Browse 패턴 |

### 링크 (Links)

| 동작 | 패턴 |
|------|------|
| 위키링크 클릭 | Browse 패턴 |
| Backlinks 패널 클릭 | Browse 패턴 |
| Outgoing Links 패널 클릭 | Browse 패턴 |

### 최근 파일 / 무작위 노트

| 동작 | 패턴 |
|------|------|
| 클릭 | Browse 패턴 |

### Canvas

| 동작 | 패턴 |
|------|------|
| Canvas 열기 | Browse 패턴 |
| Canvas 편집 | Promote 패턴 (자동 승격) |

### PDF

| 동작 | 패턴 |
|------|------|
| PDF 열기 | Browse 패턴 (읽기 전용, 승격 없음) |

### 새 노트 생성

| 트리거 | 패턴 |
|--------|------|
| 리본 버튼 (새 노트) | Create 패턴 |
| Ctrl+N / Cmd+N | Create 패턴 |
| 우클릭 → 새 노트 | Create 패턴 |
| Unique Note Creator | Create 패턴 |
| Daily Notes | Create 패턴 (특별 처리) |

---

## 부록: 용어 정의

| 용어 | 설명 |
|------|------|
| **패널 (Panel)** | 탭 그룹을 담는 컨테이너. Split으로 분할 가능 |
| **리프 (Leaf)** | 개별 탭을 의미하는 Obsidian 내부 용어 |
| **뷰 (View)** | 탭 안에 표시되는 콘텐츠 (Markdown 에디터, Graph, Canvas 등) |
| **Browse** | 파일을 둘러보는 탐색 의도 |
| **Create** | 새 파일을 생성하는 의도 |
| **Open** | 명시적으로 파일을 여는 의도 |
| **Promote** | Preview 탭을 Permanent로 승격 |
