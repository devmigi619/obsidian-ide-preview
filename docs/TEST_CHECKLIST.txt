================================================================================
                    Smart Tabs - 최종 테스트 체크리스트
================================================================================

테스트 진행 순서
================================================================================

1단계: 전체 기능 테스트 (이 문서 기반)
  - 각 기능 항목별 수동 테스트
  - 이상 동작 발견 시 "알려진 버그" 섹션에 기록
  - 모든 체크박스 완료 확인

2단계: 버그 확인 및 수정
  - 더블클릭 → 탭닫기 → 싱글클릭 문제 재현 및 수정
  - 1단계에서 발견된 버그 수정
  - 수정 후 재테스트

3단계: 리팩토링 및 코드 정리
  - 중복 코드 제거
  - 복잡한 로직 단순화
  - 주석 및 네이밍 개선
  - 불필요한 코드 삭제

4단계: 문서 마무리
  - SPEC.md 최종 검토
  - NOTES.md 정리
  - README.md 작성


================================================================================
1단계: 전체 기능 테스트
================================================================================

기능별로 정리. 파일 타입 명시가 없으면 Markdown(.md) 파일 기준.


파일 탐색기 (File Explorer)
--------------------------------------------------------------------------------

싱글클릭 (Browse 패턴)
  ✓ Empty 탭 → Preview로 열기
  ✓ Permanent 탭 → 기존 Preview 재사용 또는 새 Preview 생성
  ✓ Preview 탭 → Preview로 교체

더블클릭 (Open 패턴)
  ✓ Empty 탭 → Permanent로 열기
  ✓ Permanent 탭 → 새 Permanent 생성
  ✓ Preview (다른 파일) → Permanent로 교체
  ✓ Preview (같은 파일) → Permanent로 승격


Quick Switcher (Ctrl+O)
--------------------------------------------------------------------------------

파일 선택 (Browse 패턴)
  ✓ Empty 탭 → Preview로 열기
  ✓ Permanent 탭 → 기존 Preview 재사용 또는 새 Preview 생성
  ✓ Preview 탭 → Preview로 교체


북마크 (Bookmarks)
--------------------------------------------------------------------------------

싱글클릭 (Browse 패턴)
  ✓ Empty 탭 → Preview로 열기
  ✓ Permanent 탭 → 기존 Preview 재사용 또는 새 Preview 생성
  ✓ Preview 탭 → Preview로 교체

더블클릭 (Open 패턴)
  ✓ Empty 탭 → Permanent로 열기
  ✓ Permanent 탭 → 새 Permanent 생성
  ✓ Preview (다른 파일) → Permanent로 교체
  ✓ Preview (같은 파일) → Permanent로 승격


검색 (File Search)
--------------------------------------------------------------------------------

싱글클릭 (Browse 패턴)
  ✓ Empty 탭 → Preview로 열기
  ✓ Permanent 탭 → 기존 Preview 재사용 또는 새 Preview 생성
  ✓ Preview 탭 → Preview로 교체

더블클릭 (Open 패턴)
  ✓ Empty 탭 → Permanent로 열기
  ✓ Permanent 탭 → 새 Permanent 생성
  ✓ Preview (다른 파일) → Permanent로 교체
  ✓ Preview (같은 파일) → Permanent로 승격


그래프 뷰 (Graph View)
--------------------------------------------------------------------------------

열기 (Browse 패턴)
  ✓ Empty 탭 → Preview로 그래프뷰 열림
  ✓ Permanent 노트에서 실행 → 새 Preview 그래프뷰 생성 (Permanent 보존)
  ✓ Preview 노트에서 실행 → Preview를 그래프뷰로 교체
  ✓ 중복 방지: 그래프뷰 이미 열려있으면 → 포커스 이동만

노드 클릭 (Browse 패턴)
  ✓ Preview 그래프뷰에서 노드 클릭 → Preview에서 노트로 교체
  ✓ Permanent 그래프뷰에서 노드 클릭 → 새 Preview 노트 생성


링크 (Links)
--------------------------------------------------------------------------------

주의: 링크 클릭은 노트가 열려있어야 하므로 Empty 탭 테스트 불가

위키링크 클릭 (Browse 패턴)
  ✓ Permanent 탭에서 클릭
  ✓ Preview 탭에서 클릭

Backlinks 패널 클릭 (Browse 패턴)
  ✓ Permanent 탭에서 클릭
  ✓ Preview 탭에서 클릭

Outgoing Links 패널 클릭 (Browse 패턴)
  ✓ Permanent 탭에서 클릭
  ✓ Preview 탭에서 클릭


무작위 노트 (Random Note)
--------------------------------------------------------------------------------

열기 (Browse 패턴)
  ✓ Empty 탭
  ✓ Permanent 탭
  ✓ Preview 탭


Canvas
--------------------------------------------------------------------------------

생성 - 리본 버튼 (Create 패턴)
  ✓ Empty 탭 → Permanent로 생성 (제목 편집 모드)
  ✓ Permanent 탭 → 새 Permanent 생성 (제목 편집 모드)
  ✓ Preview 탭 → 새 Permanent 생성 (Preview 보존, 제목 편집 모드)

싱글클릭 열기 (Browse 패턴)
  ✓ Empty 탭 → Preview로 열기
  ✓ Permanent 탭 → Preview로 열기
  ✓ Preview 탭 → Preview로 교체

더블클릭 열기 (Open 패턴)
  ✓ Empty 탭 → Permanent로 열기
  ✓ Permanent 탭 → 새 Permanent 생성
  ✓ Preview (다른 Canvas) → Permanent로 교체
  ✓ Preview (같은 Canvas) → Permanent로 승격

승격 (Promote 패턴)
  ✓ 노드 추가 → Permanent 승격
  ✓ 노드 드래그 이동 → Permanent 승격
  ✓ 시점 이동/줌 → 승격 안 됨 확인 (정상)
  ✓ 파일 이름 변경 (Preview 탭) → Permanent 승격
  ✓ 탭 헤더 더블클릭 → Permanent 승격


PDF
--------------------------------------------------------------------------------

싱글클릭 열기 (Browse 패턴)
  ✓ Empty 탭 → Preview로 열기
  ✓ Permanent 탭 → Preview로 열기
  ✓ Preview 탭 → Preview로 교체

더블클릭 열기 (Browse 패턴 - md/Canvas와 다름!)
  ✓ 더블클릭으로 열어도 Preview로 열림 (Permanent 아님)

수동 승격
  ✓ 탭 헤더 더블클릭 → Permanent로 승격
  ✓ 사이드바에서 Preview PDF 더블클릭 → Permanent로 승격


새 노트 생성
--------------------------------------------------------------------------------

리본 버튼 / Ctrl+N (Create 패턴)
  ✓ Empty 탭 → Permanent로 생성 (제목 편집 모드)
  ✓ Permanent 탭 → 새 Permanent 생성 (제목 편집 모드)
  ✓ Preview 탭 → 새 Permanent 생성 (Preview 보존, 제목 편집 모드)

우클릭 → 새 노트 (Create 패턴)
  ✓ Empty 탭 → Permanent로 생성 (제목 편집 모드)
  ✓ Permanent 탭 → 새 Permanent 생성 (제목 편집 모드)
  ✓ Preview 탭 → 새 Permanent 생성 (Preview 보존, 제목 편집 모드)

Daily Notes (Create 패턴 - 생성/열기 모두 적용)

  미존재 (새로 생성)
    ✓ Empty 탭 → Permanent로 생성
    ✓ Permanent 탭 → 새 Permanent 생성
    ✓ Preview 탭 → 새 Permanent 생성, Preview 보존

  이미 존재 (열기 - Browse가 아닌 Create 패턴)
    ✓ Empty 탭 → Permanent로 열기
    ✓ Permanent 탭 → 새 Permanent로 열기
    ✓ Preview 탭 → Permanent로 열기 (Preview 보존)

Unique Note Creator (Create 패턴)
  ✓ Empty 탭 → Permanent로 생성 (제목 편집 모드)
  ✓ Permanent 탭 → 새 Permanent 생성 (제목 편집 모드)
  ✓ Preview 탭 → 새 Permanent 생성 (Preview 보존, 제목 편집 모드)


승격 트리거 - Markdown 노트 (Promote 패턴)
--------------------------------------------------------------------------------

Canvas/PDF 승격은 해당 섹션 참조

본문 편집
  ✓ Preview 탭에서 첫 글자 입력 → Permanent로 승격
  ✓ 승격 후 탭 제목이 일반체(non-italic)로 변경 확인

인라인 제목 편집 (300ms debounce)
  ✓ Preview 탭에서 인라인 제목 수정 → 300ms 후 Permanent로 승격
  ✓ 빠른 연속 수정 시 300ms 후 1회만 승격 확인

파일 이름 변경
  ✓ Preview 탭 파일의 이름을 탐색기에서 변경 → Permanent로 승격

탭 헤더 더블클릭
  ✓ Preview 탭 헤더 더블클릭 → Permanent로 승격


전역 규칙
--------------------------------------------------------------------------------

패널당 Preview 1개
  ✓ Permanent 탭에서 파일 A 싱글클릭 → Preview 생성
  ✓ 계속해서 파일 B 싱글클릭 → 기존 Preview 재사용 (파일 A → B로 교체)
  ✓ Preview + Empty 상태에서 새 파일 싱글클릭 → 빈 탭보다 Preview 우선 재사용

중복 열기 방지
  ✓ 같은 파일 재클릭 → 포커스 이동 (새 탭 생성 안 됨)
  ✓ 그래프뷰 재실행 → 포커스 이동 (새 탭 생성 안 됨)
  ✓ 다른 패널에서 같은 파일 열기 → 정상 동작 (패널별 독립)

Modifier Key 동작
  ✓ Ctrl/Cmd + 파일 탐색기 클릭 → 새 Permanent 탭 생성
  ✓ Ctrl/Cmd + 북마크 클릭 → 새 Permanent 탭 생성
  ✓ Ctrl/Cmd + 검색 결과 클릭 → 새 Permanent 탭 생성

포커스 관리
  ✓ 새 탭 생성 시 해당 탭으로 포커스 이동
  ✓ 탭 닫기 시 탐색기 선택 상태 정리 (is-active, has-focus 제거) — 2단계 #1에서 해결


================================================================================
2단계: 버그 확인 및 수정
================================================================================

알려진 버그 목록
--------------------------------------------------------------------------------

1. 더블클릭 → 탭닫기 → 싱글클릭 문제 (해결 ✓)
--------------------------------------------------------------------------------

원래 현상 (Obsidian 기본 버그):
  - 더블클릭으로 파일 열기 → 바로 탭 닫기 → is-active/has-focus 잔류
  - 같은 파일 재클릭 시 아무 반응 없음

근본 원인:
  - detach 후 Obsidian 워크스페이스 레벨 상태 문제로 file-open 이벤트 미발생
  - 탐색기 내부 상태(activeDom, tree.activeDom) 문제가 아님

수정 내역:
  ✓ 2단계 접근: detach 시 DOM 정리(Phase1+Phase2) + handleOpenFile에서 보정
  ✓ ensureExplorerActiveState(): 파일 연 후 activeDom 불일치 시 onFileOpen(file) 강제 호출
  ✓ clearSidebarInternalState(): detach 전 내부 상태 리셋
  ✓ cleanStaleSidebarDOM(): detach 후 잔류 DOM 클래스 정리

핵심 교훈:
  - "닫을 때 정리" 대신 "열 때 보정" 전략이 견고함
  - onFileOpen(null)은 explorerView.activeDom만 초기화, tree.activeDom은 미초기화


2. Daily Notes 판별 패턴 개선 (해결 ✓)
--------------------------------------------------------------------------------

수정 내역:
  ✓ handleOpenFile: Daily Note일 때 rename = "all" 스킵
  ✓ 중복 방지: intent === "browse" 조건 제거 → 모든 intent에 적용
  ✓ 하드코딩 패턴 제거 → isDailyNote() 메서드로 교체
  ✓ internalPlugins API로 Daily Notes 설정(format/folder) 동적 읽기
  ✓ moment strict 파싱으로 커스텀 포맷 지원 확인


4. Modifier Key (Ctrl+Click) 동작 이상 (해결 ✓)
--------------------------------------------------------------------------------

수정 내역:
  ✓ Ctrl+Click 감지를 click → mousedown 캡처 페이즈로 변경
  ✓ isFileElement()에 .tree-item-self 셀렉터 추가 (검색 결과 등 대응)


5. 테스트 중 발견된 버그
--------------------------------------------------------------------------------

(여기에 테스트 중 발견된 버그를 추가하세요)


================================================================================
3단계: 리팩토링 체크리스트
================================================================================

중복 코드 제거
  ☐ 유사한 패턴 함수 통합
  ☐ 반복되는 로직 유틸리티 함수화

복잡한 로직 단순화
  ☐ handleOpenFile 분석 및 단순화 검토
  ☐ determineOpenIntent 가독성 개선
  ☐ 중첩된 if문 평탄화

주석 및 네이밍 개선
  ☐ 불명확한 변수명 개선
  ☐ 복잡한 로직에 주석 추가
  ☐ JSDoc 주석 추가

불필요한 코드 삭제
  ☐ 사용하지 않는 변수/함수 제거
  ☐ 디버그 로그 정리 (debug mode 전용으로)
  ☐ 주석 처리된 코드 삭제

타입 안전성 강화
  ☐ any 타입 최소화
  ☐ 옵셔널 체이닝 활용
  ☐ 타입 가드 추가


================================================================================
4단계: 문서 마무리
================================================================================

SPEC.md
  ☐ 모든 구현 기능 반영 확인
  ☐ 예제 시나리오 정확성 검증
  ☐ 오타 및 문법 체크

NOTES.md
  ☐ 중요한 발견 사항 정리
  ☐ 디버깅 팁 추가
  ☐ API 레퍼런스 업데이트

README.md (사용자용)
  ☐ 플러그인 소개
  ☐ 주요 기능 설명
  ☐ 설치 방법
  ☐ 사용 가이드
  ☐ 스크린샷/GIF 추가 (선택)
  ☐ 알려진 제한사항 명시


================================================================================
진행 상황
================================================================================

전체 진행률
  - 1단계: 100% (89/89 항목) - 전체 통과
    * 링크 Empty 탭 3개: 테스트 불가(N/A), 항목에서 제외
    * 최근 파일: 별도 플러그인 필요, 테스트 제외
  - 2단계: 미시작
  - 3단계: 미시작
  - 4단계: 미시작

체크포인트
  ☐ 1단계 완료 (모든 기능 테스트 완료)
  ☐ 2단계 완료 (모든 버그 수정 완료)
  ☐ 3단계 완료 (코드 정리 완료)
  ☐ 4단계 완료 (문서화 완료)
  ☐ 최종 릴리스 준비 완료
